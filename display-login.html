<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Login Display - Karaoke Bus</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
font-family: Arial, sans-serif;
background: linear-gradient(135deg, #667eea, #764ba2);
height: 100vh;
display: flex;
justify-content: center;
align-items: center;
margin: 0;
}
.card {
background: #fff;
padding: 40px;
border-radius: 20px;
width: 100%;
max-width: 360px;
box-shadow: 0 20px 50px rgba(0,0,0,.3);
text-align: center;
}
h1 { margin-bottom: 20px; color: #333; }
p { color: #666; margin-bottom: 20px; }
input {
width: 100%;
padding: 15px;
border-radius: 12px;
border: 1px solid #ccc;
font-size: 16px;
margin-bottom: 15px;
box-sizing: border-box;
}
input:focus { outline: none; border-color: #667eea; }
button {
width: 100%;
padding: 15px;
border: none;
border-radius: 12px;
background: #667eea;
color: white;
font-size: 16px;
font-weight: bold;
cursor: pointer;
transition: all 0.3s;
}
button:hover { background: #556cd6; }
button:disabled {
background: #ccc;
cursor: not-allowed;
}
.error {
color: red;
margin-top: 10px;
display: none;
font-weight: 600;
}
.back-link {
display: inline-block;
margin-top: 20px;
color: #667eea;
text-decoration: none;
font-weight: 600;
transition: all 0.3s;
}
.back-link:hover { color: #556cd6; }
</style>
</head>
<body>
<div class="card">
<h1>üì∫ Layar Karaoke</h1>
<p>Masukkan password untuk melanjutkan</p>
<input type="password" id="password" placeholder="Password display" onkeypress="if(event.key==='Enter') login()" autofocus>
<button onclick="login()" id="login-btn">Masuk</button>
<div class="error" id="error">‚ùå Password salah</div>
<a href="#" onclick="goBackHome()" class="back-link">‚Üê Kembali ke Beranda</a>
</div>

<!-- Custom Modal -->
<script src="js/custom-modal.js"></script>

<script>
// Password display
const DISPLAY_PASSWORD = "displaybus9999";

// ========= HAPUS TOKEN LAMA (Agar selalu diminta password) =========
sessionStorage.removeItem('displayAuth');
sessionStorage.removeItem('displayLoginTime');
sessionStorage.removeItem('display_token');

// ========= CEK JIKA SUDAH LOGIN DI SESSION INI =========
// Hapus auto-redirect agar selalu minta password

// ========= LOGIN FUNCTION =========
function login() {
  const input = document.getElementById("password").value;
  const errorEl = document.getElementById("error");
  const loginBtn = document.getElementById("login-btn");
  
  if (input === DISPLAY_PASSWORD) {
    // Disable button
    loginBtn.disabled = true;
    loginBtn.textContent = 'Memverifikasi...';
    
    // ‚úÖ GENERATE TOKEN (Security)
    const token = generateDisplayToken();
    
    // Set authentication token
    sessionStorage.setItem("displayAuth", "authenticated");
    sessionStorage.setItem("displayLoginTime", Date.now());
    sessionStorage.setItem("display_token", token);
    
    console.log('‚úÖ Display authenticated with token');
    
    // Redirect ke display
    window.location.href = "display.html";
  } else {
    // Show error
    errorEl.style.display = "block";
    document.getElementById("password").value = "";
    document.getElementById("password").focus();
    // Hide error after 3 seconds
    setTimeout(() => {
      errorEl.style.display = "none";
    }, 3000);
  }
}

// ========= GENERATE SECURE TOKEN =========
function generateDisplayToken() {
  const timestamp = Date.now();
  const random = Math.random().toString(36).substring(2, 15);
  const data = `display-${timestamp}-${random}`;
  
  let hash = 0;
  for (let i = 0; i < data.length; i++) {
    const char = data.charCodeAt(i);
    hash = ((hash << 5) - hash) + char;
    hash = hash & hash;
  }
  
  return `DISPLAY_TOKEN_${Math.abs(hash).toString(36)}_${timestamp}`;
}

// Kembali ke beranda dengan konfirmasi
async function goBackHome() {
  const result = await customConfirm(
    'Anda akan kembali ke beranda tanpa mengaktifkan display.', 
    {
      title: 'Kembali ke Beranda?',
      icon: 'üè†',
      confirmText: 'Ya, Kembali',
      cancelText: 'Batal'
    }
  );
  
  if (result) {
    window.location.href = 'index.html';
  }
}
</script>
</body>
</html>